var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,n=(e,t)=>{for(var a in t||(t={}))o.call(t,a)&&r(e,a,t[a]);if(l)for(var a of l(t))s.call(t,a)&&r(e,a,t[a]);return e},d=(e,l)=>t(e,a(l));import{m as u,l as i,w as p,c,a as m,k as f,f as v,b as h,d as b,i as V,e as _,g as y,h as g,j as k,V as O,n as $,M as w,A as x,o as U,p as P,q as j,t as S,r as F,s as I,u as C,v as M,x as E,y as A,F as D,z as T,B as R,I as z,C as G,D as W,E as q,G as B,H as L}from"./vendor.43b5e014.js";const N=[{id:"instrument",availableValues:void 0,default:"",dependsOn:[],compute:void 0,update:{type:"reset",excludeItems:["trade_type"]}},{id:"trade_type",availableValues:["long","short"],default:void 0,dependsOn:["lots"],compute:e=>{const t=e.$lots;if(0!==t&&void 0!==t)return t>0?"long":"short"},update:{type:"reset",excludeItems:["instrument"]}},{id:"enter_price",availableValues:void 0,default:0,dependsOn:[],compute:void 0,update:{type:"update"}},{id:"stop_price",availableValues:void 0,default:void 0,formula:"\n      offset = roundAs($stop_pts * $price_step, $price_step)\n      $enter_price + offset * sign($lots) * -1\n    ",update:{type:"update"}},{id:"take_price",availableValues:void 0,default:void 0,formula:"\n      offset = roundAs($take_pts * $price_step, $price_step)\n      $enter_price + offset * sign($lots)\n    ",update:{type:"update"}},{id:"lots",availableValues:void 0,default:0,dependsOn:[],compute:void 0,update:{type:"update",excludeItems:["stop_pts","take_pts"]}},{id:"price_step",availableValues:void 0,default:1,update:{type:"update"}},{id:"pts_cost",availableValues:void 0,default:1,dependsOn:[],compute:void 0,update:{type:"update"}},{id:"stop_pts",availableValues:void 0,default:0,formula:"\n      ceil(abs($enter_price - $stop_price) / $price_step)\n    ",update:{type:"update"}},{id:"take_pts",availableValues:void 0,default:0,formula:"\n      ceil(abs($enter_price - $take_price) / $price_step)\n    ",update:{type:"update"}}];var H,J;function K(e){const t=function(e){const t=e.reduce(((e,t)=>(e[t.id]=new Set,e)),{});for(const{id:l,dependsOn:o}of e)for(const e of o)try{t[e].add(l)}catch(a){throw new Error(`Could not find dependency ${e}`)}return i.exports.mapValues(t,(e=>[...e]))}(e),a=e.map((e=>{const a=function(e,t=[]){return i.exports.mapValues(e,(e=>p(e,...t)))}(t,e.exclude);return function(e,t){const a=function(e){return i.exports.mapValues(e,(()=>0))}(t),l=[];return Q(e,a,t,l),{id:e,dependencies:l.reverse().slice(1),ignored:[]}}(e.id,a)}));return u(a,(e=>e.id))}function Q(e,t,a,l){t[e]=1;for(const o of a[e]){0===t[o]&&Q(o,t,a,l)}l.push(e)}(J=H||(H={}))[J.White=0]="White",J[J.Grey=1]="Grey";const X=c(m);X.import({roundAs(e,t){const a=1/t,l=X.log10(a),o=X.max(X.floor(l),0);return X.round(e,o)}},{});class Y{constructor(e){var t,a,l,o;if(this.updatePath=[],this.id=e.id,this.availableValues=null!=(t=e.availableValues)?t:[],this.formula=null!=(a=e.formula)?a:"",this.update=b(e.update,{type:"update"}),e.formula){const{deps:t,f:a}=function(e){const t=X.parse(e),a=t.filter((e=>{var t;return e.isSymbolNode&&(null==(t=e.name)?void 0:t.startsWith("$"))})).map((e=>{var t;return null==(t=e.name)?void 0:t.substring(1)})),l=t.compile();return{deps:[...new Set(a)],f:e=>{try{const t=l.evaluate(e);return V(t)?_(y(t,"entries")):t}catch(t){return void console.warn(t)}}}}(e.formula);this.dependsOn=t,this.compute=a}else this.dependsOn=null!=(l=e.dependsOn)?l:[],this.compute=null!=(o=e.compute)?o:e=>{};this.isValueAvailable=(e,t)=>this.availableValues.includes(t),g(e.default)?this.defaultValue=e.default:this.defaultValue=t=>e.default}}class Z{constructor(e){this.properties=f(e,(e=>e.id))}buildDefaultState(){const e={};return v(this.properties,((t,a)=>{e[a]=t.defaultValue(e)})),e}update(e,t,a){a=this.createState(a);try{const l=[],o=this.properties[e];return this.commit(e,t,a,l),"update"===o.update.type?this.innerUpdate(o,a,l):"reset"===o.update.type?this.innerReset(o,a,l):console.warn(`Unknown update type '${o.update.type}'for property '${e}'`),l}catch(l){return console.error(`Error update. Prop: ${e}`,l),[]}}recompute(e,t){try{t=this.createState(t);return{prop:e,value:this.properties[e].compute(t)}}catch(a){return console.error(`Error update. Prop: ${e}`,a),{prop:e,value:void 0}}}commit(e,t,a,l){a[`$${e}`]=t,l.push({prop:e,value:t})}innerUpdate(e,t,a){const l=e.updatePath.map((e=>this.properties[e]));for(const o of l){const e=o.compute(t);this.commit(o.id,e,t,a)}}innerReset(e,t,a){var l;const o=[...null!=(l=e.update.excludeItems)?l:[],e.id],s=h(this.properties,(e=>!o.includes(e.id)));for(const r of s)a.push({prop:r.id,value:r.defaultValue(t)})}createState(e){return u(e,((e,t)=>`$${t}`))}}function ee(e){const t=e.map((e=>new Y(e))),a=K(t.map((e=>{var t,a,l;return{id:e.id,dependsOn:null!=(t=e.dependsOn)?t:[],exclude:null!=(l=null==(a=e.update)?void 0:a.excludeItems)?l:[]}})));for(const l of t){const e=a[l.id].dependencies;l.updatePath=e}return new Z(t)}const te=k({strict:!1});var ae=Object.defineProperty,le=Object.getOwnPropertyDescriptor,oe=(e,t,a,l)=>{for(var o,s=l>1?void 0:l?le(t,a):t,r=e.length-1;r>=0;r--)(o=e[r])&&(s=(l?o(t,a,s):o(s))||s);return l&&s&&ae(t,a,s),s};let se=class extends O{constructor(){super(...arguments),this.dataItems=N,this.dataObj=ee(this.dataItems),this.state=this.dataObj.buildDefaultState()}mutateValues(e){for(const{prop:t,value:a}of e)this.state[t]=a}mutateModule(e){this.dataItems=e.dataItems,this.dataObj=e.dataObj,this.state=e.state}async addField(e){const t=[...this.dataItems,e],a=ee(t),l=a.buildDefaultState(),o=b($(this.state),l);this.mutateModule({dataItems:t,dataObj:a,state:o});const s=a.recompute(e.id,o);this.mutateValues([s])}async update({prop:e,value:t}){try{const a=this.dataObj.update(e,t,this.state);this.mutateValues(a)}catch(a){console.error("update err",a)}}};oe([w],se.prototype,"mutateValues",1),oe([w],se.prototype,"mutateModule",1),oe([x],se.prototype,"addField",1),oe([x],se.prototype,"update",1),se=oe([U],se);var re=new se({store:te,name:"trade_edit_module"}),ne=Object.defineProperty,de=Object.getOwnPropertyDescriptor,ue=(e,t,a,l)=>{for(var o,s=l>1?void 0:l?de(t,a):t,r=e.length-1;r>=0;r--)(o=e[r])&&(s=(l?o(t,a,s):o(s))||s);return l&&s&&ne(t,a,s),s};let ie=class extends O{constructor(){super(...arguments),this.instuments=[{title:"Favotites",instruments:[{instrument:"sim6"},{instrument:"brm6"},{instrument:"rim6"}]},{title:"Other",instruments:[{instrument:"mmm6"},{instrument:"lkm6"},{instrument:"rnm6"},{instrument:"mtm6"}]}]}add(){}};ue([w],ie.prototype,"add",1),ie=ue([U({generateMutationSetters:!0})],ie);var pe=new ie({store:te,name:"instruments_module"});const ce={props:{model:{type:Object,required:!0}},emits:{update:e=>!0}};function me(e,t){return a=>P({get:()=>e.value[a],set:e=>{console.log("emit",{prop:a,value:e}),t("update",{prop:a,value:e})}})}var fe=j(d(n({},ce),{setup(e,{emit:t}){const a=me(S(e).model,t),l=P((()=>pe.instuments)),o=a("trade_type"),s=P((()=>"long"===o.value?"Long":"short"===o.value?"Short":"New trade"));return{instruments:l,inst:a("instrument"),enter:a("enter_price"),stop:a("stop_price"),take:a("take_price"),lots:a("lots"),tradeType:s}}}));const ve={class:"flex"},he={class:"flex-1"};fe.render=function(e,t,a,l,o,s){const r=F("el-option"),n=F("el-option-group"),d=F("el-select"),u=F("el-input-number"),i=F("el-form-item"),p=F("el-card"),c=F("el-form");return I(),C(c,{class:"addtrade-form"},{default:M((()=>[E(p,{class:"input-header"},{header:M((()=>[E("div",ve,[E("span",he,A(e.tradeType),1),E(d,{class:"w-30",modelValue:e.inst,"onUpdate:modelValue":t[1]||(t[1]=t=>e.inst=t),filterable:"",placeholder:"Instrument"},{default:M((()=>[(I(!0),C(D,null,T(e.instruments,(e=>(I(),C(n,{key:e.title,label:e.title},{default:M((()=>[(I(!0),C(D,null,T(e.instruments,(e=>(I(),C(r,{key:e.instrument,label:e.instrument,value:e.instrument},null,8,["label","value"])))),128))])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])])),default:M((()=>[E(i,{label:"Enter price"},{default:M((()=>[E(u,{modelValue:e.enter,"onUpdate:modelValue":t[2]||(t[2]=t=>e.enter=t),"controls-position":"right"},null,8,["modelValue"])])),_:1}),E(i,{label:"Stop price"},{default:M((()=>[E(u,{modelValue:e.stop,"onUpdate:modelValue":t[3]||(t[3]=t=>e.stop=t),"controls-position":"right"},null,8,["modelValue"])])),_:1}),E(i,{label:"Take price"},{default:M((()=>[E(u,{modelValue:e.take,"onUpdate:modelValue":t[4]||(t[4]=t=>e.take=t),"controls-position":"right"},null,8,["modelValue"])])),_:1}),E(i,{label:"Lots"},{default:M((()=>[E(u,{modelValue:e.lots,"onUpdate:modelValue":t[5]||(t[5]=t=>e.lots=t),"controls-position":"right"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})};var be=j(d(n({},ce),{setup(e,{emit:t}){const a=me(S(e).model,t);return{priceStep:a("price_step"),ptsCost:a("pts_cost"),stop:a("stop_pts"),take:a("take_pts")}}}));be.render=function(e,t,a,l,o,s){const r=F("el-input-number"),n=F("el-form-item"),d=F("el-card"),u=F("el-form");return I(),C(u,{class:"addtrade-form"},{default:M((()=>[E(d,{header:"Risk"},{default:M((()=>[E(n,{label:"Price step"},{default:M((()=>[E(r,{modelValue:e.priceStep,"onUpdate:modelValue":t[1]||(t[1]=t=>e.priceStep=t),"controls-position":"right"},null,8,["modelValue"])])),_:1}),E(n,{label:"Pts cost"},{default:M((()=>[E(r,{modelValue:e.ptsCost,"onUpdate:modelValue":t[2]||(t[2]=t=>e.ptsCost=t),"controls-position":"right"},null,8,["modelValue"])])),_:1}),E(n,{label:"Stop pts"},{default:M((()=>[E(r,{modelValue:e.stop,"onUpdate:modelValue":t[3]||(t[3]=t=>e.stop=t),"controls-position":"right"},null,8,["modelValue"])])),_:1}),E(n,{label:"Take pts"},{default:M((()=>[E(r,{modelValue:e.take,"onUpdate:modelValue":t[4]||(t[4]=t=>e.take=t),"controls-position":"right"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})};const Ve=["instrument","enter_price","stop_price","take_price","lots","price_step","pts_cost","stop_pts","take_pts","trade_type"];var _e=j(d(n({},ce),{setup(e,{emit:t}){const a=S(e).model,l=me(a,t),o=P((()=>p(G(a.value),...Ve).map((e=>({key:e,value:l(e)}))))),s=P((()=>0===o.value.length)),r=R(!1),n=R({id:"",formula:""});return{formProps:o,isFormEmpty:s,dialogVisible:r,addModel:n,addField:()=>{const e=n.value;""!==e.id.trim()&&""!==e.formula.trim()?(re.addField(n.value),r.value=!1,n.value={id:"",formula:""}):z.error("Incorrect input :(")},removeField:e=>{}}}}));const ye={class:"flex"},ge=E("span",{class:"flex-1"},"Other form items",-1),ke=q("Cancel"),Oe=q("Create");_e.render=function(e,t,a,l,o,s){const r=F("el-button"),n=F("el-input-number"),d=F("el-form-item"),u=F("el-empty"),i=F("el-card"),p=F("el-input"),c=F("el-form"),m=F("el-dialog");return I(),C(c,{class:"addtrade-form"},{default:M((()=>[E(i,{class:"input-header"},{header:M((()=>[E("div",ye,[ge,E(r,{circle:"",onClick:t[1]||(t[1]=t=>e.dialogVisible=!0),icon:"el-icon-plus"})])])),default:M((()=>[(I(!0),C(D,null,T(e.formProps,(e=>(I(),C(d,{key:e.key,label:e.key},{default:M((()=>[E(n,{modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label"])))),128)),e.isFormEmpty?(I(),C(u,{key:0,class:"p-0","image-size":50,description:"Add new form item! Example: $take_pts * $lots * $pts_cost"})):W("",!0)])),_:1}),E(m,{title:"Add form item",modelValue:e.dialogVisible,"onUpdate:modelValue":t[5]||(t[5]=t=>e.dialogVisible=t)},{footer:M((()=>[E(r,{onClick:t[4]||(t[4]=t=>e.dialogVisible=!1),icon:"el-icon-close"},{default:M((()=>[ke])),_:1}),E(r,{type:"primary",onClick:e.addField,icon:"el-icon-check"},{default:M((()=>[Oe])),_:1},8,["onClick"])])),default:M((()=>[E(c,{model:e.addModel},{default:M((()=>[E(d,{label:"Field name"},{default:M((()=>[E(p,{modelValue:e.addModel.id,"onUpdate:modelValue":t[2]||(t[2]=t=>e.addModel.id=t),"controls-position":"right"},null,8,["modelValue"])])),_:1}),E(d,{label:"Formula"},{default:M((()=>[E(p,{modelValue:e.addModel.formula,"onUpdate:modelValue":t[3]||(t[3]=t=>e.addModel.formula=t),"controls-position":"right"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])),_:1})};var $e=j({name:"App",components:{TradeBasicParamsForm:fe,TradeRiskParamsForm:be,OthersParamsForm:_e},setup:()=>({data:P((()=>re.state)),upd:e=>{re.update(e)}})});const we={class:"flex justify-center container m-8"},xe={class:"addtrade-form inline-grid gap-4"};$e.render=function(e,t,a,l,o,s){const r=F("trade-basic-params-form"),n=F("trade-risk-params-form"),d=F("others-params-form");return I(),C("div",we,[E("div",xe,[E(r,{class:"max-w-62",model:e.data,onUpdate:e.upd},null,8,["model","onUpdate"]),E(n,{class:"max-w-62",model:e.data,onUpdate:e.upd},null,8,["model","onUpdate"]),E(d,{class:"max-w-62 sm:col-span-2 sm:max-w-200",model:e.data,onUpdate:e.upd},null,8,["model","onUpdate"])])])};const Ue=B($e);Ue.use(te),Ue.use(L,{size:"mini"}),Ue.mount("#app");
